<!doctype html><html lang=en dir=auto><head><meta charset=utf-8><meta http-equiv=X-UA-Compatible content="IE=edge"><meta name=viewport content="width=device-width,initial-scale=1,shrink-to-fit=no"><meta name=robots content="index, follow"><title>Create query API for 500 million Weibo data | Vincent's Notes</title>
<meta name=keywords content="Weibo,Clickhouse"><meta name=description content="Preparation Clickhouse Database Linux/Windows/macOS Server Data Import First you need to deploy Clickhouse and finish creating a brand new database. Create two tables. Table For Query Weibo Uid.
CREATE TABLE wb_uid( uid String, mobile String )ENGINE = MergeTree() ORDER BY (uid) PRIMARY KEY (uid); Table For Query Mobile Phone Number
CREATE TABLE wb_mobile( uid String, mobile String )ENGINE = MergeTree() ORDER BY (mobile) PRIMARY KEY (mobile); Query Data WeiboSearcher is an API program written in Golang."><meta name=author content="Vincent Young"><link rel=canonical href=https://missuo.me/posts/weibo-data-searcher/><link crossorigin=anonymous href=/assets/css/stylesheet.4109dc267d8f2a484efdaa6f3c642373dfe84bbb89bd07db62f3986fdb1b0308.css integrity="sha256-QQncJn2PKkhO/apvPGQjc9/oS7uJvQfbYvOYb9sbAwg=" rel="preload stylesheet" as=style><script defer crossorigin=anonymous src=/assets/js/highlight.f413e19d0714851f6474e7ee9632408e58ac146fbdbe62747134bea2fa3415e0.js integrity="sha256-9BPhnQcUhR9kdOfuljJAjlisFG+9vmJ0cTS+ovo0FeA=" onload=hljs.initHighlightingOnLoad()></script><link rel=icon href=https://r2.qwq.mx/blog/20230104uZXT8s.ico><link rel=icon type=image/png sizes=16x16 href=https://r2.qwq.mx/blog/20230104uZXT8s.ico><link rel=icon type=image/png sizes=32x32 href=https://r2.qwq.mx/blog/20230104uZXT8s.ico><link rel=apple-touch-icon href=https://r2.qwq.mx/blog/20230104uZXT8s.ico><link rel=mask-icon href=https://r2.qwq.mx/blog/20230104uZXT8s.ico><meta name=theme-color content="#2e2e33"><meta name=msapplication-TileColor content="#2e2e33"><link rel=alternate hreflang=en href=https://missuo.me/posts/weibo-data-searcher/><noscript><style>#theme-toggle,.top-link{display:none}</style><style>@media(prefers-color-scheme:dark){:root{--theme:rgb(29, 30, 32);--entry:rgb(46, 46, 51);--primary:rgb(218, 218, 219);--secondary:rgb(155, 156, 157);--tertiary:rgb(65, 66, 68);--content:rgb(196, 196, 197);--hljs-bg:rgb(46, 46, 51);--code-bg:rgb(55, 56, 62);--border:rgb(51, 51, 51)}.list{background:var(--theme)}.list:not(.dark)::-webkit-scrollbar-track{background:0 0}.list:not(.dark)::-webkit-scrollbar-thumb{border-color:var(--theme)}}</style></noscript><script async src="https://www.googletagmanager.com/gtag/js?id=GTM-KV7KW3LH"></script><script>var dnt,doNotTrack=!1;if(!1&&(dnt=navigator.doNotTrack||window.doNotTrack||navigator.msDoNotTrack,doNotTrack=dnt=="1"||dnt=="yes"),!doNotTrack){window.dataLayer=window.dataLayer||[];function gtag(){dataLayer.push(arguments)}gtag("js",new Date),gtag("config","GTM-KV7KW3LH")}</script><meta property="og:title" content="Create query API for 500 million Weibo data"><meta property="og:description" content="Preparation Clickhouse Database Linux/Windows/macOS Server Data Import First you need to deploy Clickhouse and finish creating a brand new database. Create two tables. Table For Query Weibo Uid.
CREATE TABLE wb_uid( uid String, mobile String )ENGINE = MergeTree() ORDER BY (uid) PRIMARY KEY (uid); Table For Query Mobile Phone Number
CREATE TABLE wb_mobile( uid String, mobile String )ENGINE = MergeTree() ORDER BY (mobile) PRIMARY KEY (mobile); Query Data WeiboSearcher is an API program written in Golang."><meta property="og:type" content="article"><meta property="og:url" content="https://missuo.me/posts/weibo-data-searcher/"><meta property="og:image" content="https://r2.qwq.mx/blog/20240331dCkqHY.jpg"><meta property="article:section" content="posts"><meta property="article:published_time" content="2023-02-09T03:32:33+08:00"><meta property="article:modified_time" content="2023-02-09T03:32:33+08:00"><meta property="og:site_name" content="Vincent's Notes"><meta name=twitter:card content="summary_large_image"><meta name=twitter:image content="https://r2.qwq.mx/blog/20240331dCkqHY.jpg"><meta name=twitter:title content="Create query API for 500 million Weibo data"><meta name=twitter:description content="Preparation Clickhouse Database Linux/Windows/macOS Server Data Import First you need to deploy Clickhouse and finish creating a brand new database. Create two tables. Table For Query Weibo Uid.
CREATE TABLE wb_uid( uid String, mobile String )ENGINE = MergeTree() ORDER BY (uid) PRIMARY KEY (uid); Table For Query Mobile Phone Number
CREATE TABLE wb_mobile( uid String, mobile String )ENGINE = MergeTree() ORDER BY (mobile) PRIMARY KEY (mobile); Query Data WeiboSearcher is an API program written in Golang."><script type=application/ld+json>{"@context":"https://schema.org","@type":"BreadcrumbList","itemListElement":[{"@type":"ListItem","position":1,"name":"Posts","item":"https://missuo.me/posts/"},{"@type":"ListItem","position":2,"name":"Create query API for 500 million Weibo data","item":"https://missuo.me/posts/weibo-data-searcher/"}]}</script><script type=application/ld+json>{"@context":"https://schema.org","@type":"BlogPosting","headline":"Create query API for 500 million Weibo data","name":"Create query API for 500 million Weibo data","description":"Preparation Clickhouse Database Linux/Windows/macOS Server Data Import First you need to deploy Clickhouse and finish creating a brand new database. Create two tables. Table For Query Weibo Uid.\nCREATE TABLE wb_uid( uid String, mobile String )ENGINE = MergeTree() ORDER BY (uid) PRIMARY KEY (uid); Table For Query Mobile Phone Number\nCREATE TABLE wb_mobile( uid String, mobile String )ENGINE = MergeTree() ORDER BY (mobile) PRIMARY KEY (mobile); Query Data WeiboSearcher is an API program written in Golang.","keywords":["Weibo","Clickhouse"],"articleBody":"Preparation Clickhouse Database Linux/Windows/macOS Server Data Import First you need to deploy Clickhouse and finish creating a brand new database. Create two tables. Table For Query Weibo Uid.\nCREATE TABLE wb_uid( uid String, mobile String )ENGINE = MergeTree() ORDER BY (uid) PRIMARY KEY (uid); Table For Query Mobile Phone Number\nCREATE TABLE wb_mobile( uid String, mobile String )ENGINE = MergeTree() ORDER BY (mobile) PRIMARY KEY (mobile); Query Data WeiboSearcher is an API program written in Golang. But he is not out of the box, because there is no configuration file that allows you to modify the database information, which will be supported in the future. But you can modify some of the configuration code and recompile it yourself.\n./weibo_linux_amd64 Q\u0026A Why not use a MySQL database? Because even after building indexes, sorting, and splitting tables, MySQL data is much worse than Clickhouse, I gave up on optimizing MySQL query speed.\nWhy use two tables? Because two tables are used and the indexes are different fields. It can greatly speed up the query efficiency.\nWhere is the data downloaded from? We do not provide any data, and we do not keep any data. Please find your own data sources.\n","wordCount":"198","inLanguage":"en","datePublished":"2023-02-09T03:32:33+08:00","dateModified":"2023-02-09T03:32:33+08:00","author":{"@type":"Person","name":"Vincent Young"},"mainEntityOfPage":{"@type":"WebPage","@id":"https://missuo.me/posts/weibo-data-searcher/"},"publisher":{"@type":"Organization","name":"Vincent's Notes","logo":{"@type":"ImageObject","url":"https://r2.qwq.mx/blog/20230104uZXT8s.ico"}}}</script></head><body id=top><script>localStorage.getItem("pref-theme")==="dark"?document.body.classList.add("dark"):localStorage.getItem("pref-theme")==="light"?document.body.classList.remove("dark"):window.matchMedia("(prefers-color-scheme: dark)").matches&&document.body.classList.add("dark")</script><header class=header><nav class=nav><div class=logo><a href=https://missuo.me/ accesskey=h title="Vincent's Notes (Alt + H)">Vincent's Notes</a><div class=logo-switches><button id=theme-toggle accesskey=t title="(Alt + T)"><svg id="moon" xmlns="http://www.w3.org/2000/svg" width="24" height="18" viewBox="0 0 24 24" fill="none" stroke="currentcolor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><path d="M21 12.79A9 9 0 1111.21 3 7 7 0 0021 12.79z"/></svg><svg id="sun" xmlns="http://www.w3.org/2000/svg" width="24" height="18" viewBox="0 0 24 24" fill="none" stroke="currentcolor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><circle cx="12" cy="12" r="5"/><line x1="12" y1="1" x2="12" y2="3"/><line x1="12" y1="21" x2="12" y2="23"/><line x1="4.22" y1="4.22" x2="5.64" y2="5.64"/><line x1="18.36" y1="18.36" x2="19.78" y2="19.78"/><line x1="1" y1="12" x2="3" y2="12"/><line x1="21" y1="12" x2="23" y2="12"/><line x1="4.22" y1="19.78" x2="5.64" y2="18.36"/><line x1="18.36" y1="5.64" x2="19.78" y2="4.22"/></svg></button><ul class=lang-switch><li>|</li></ul></div></div><ul id=menu><li><a href=https://missuo.me/ title=Home><span>Home</span></a></li><li><a href=https://missuo.me/archives/ title=Archive><span>Archive</span></a></li><li><a href=https://missuo.me/tags/ title=Tags><span>Tags</span></a></li><li><a href=https://missuo.me/search/ title="Search (Alt + /)" accesskey=/><span>Search</span></a></li><li><a href=https://missuo.me/about/ title=About><span>About</span></a></li></ul></nav></header><main class=main><article class=post-single><header class=post-header><h1 class=post-title>Create query API for 500 million Weibo data</h1><div class=post-meta><span title='2023-02-09 03:32:33 +0800 +0800'>Thursday, February 9, 2023</span>&nbsp;·&nbsp;Vincent Young</div></header><div class=toc><details open><summary accesskey=c title="(Alt + C)"><span class=details>Table of Contents</span></summary><div class=inner><ul><li><a href=#preparation aria-label=Preparation>Preparation</a></li><li><a href=#data-import aria-label="Data Import">Data Import</a></li><li><a href=#query-data aria-label="Query Data">Query Data</a></li><li><a href=#qa aria-label=Q&amp;amp;A>Q&amp;A</a></li></ul></div></details></div><div class=post-content><h2 id=preparation>Preparation<a hidden class=anchor aria-hidden=true href=#preparation>#</a></h2><ul><li>Clickhouse Database</li><li>Linux/Windows/macOS Server</li></ul><h2 id=data-import>Data Import<a hidden class=anchor aria-hidden=true href=#data-import>#</a></h2><ol><li>First you need to deploy Clickhouse and finish creating a brand new database.</li><li>Create two tables.</li></ol><p>Table For Query Weibo Uid.</p><div class=highlight><pre tabindex=0 class=chroma><code class=language-sql data-lang=sql><span class=line><span class=cl><span class=k>CREATE</span><span class=w> </span><span class=k>TABLE</span><span class=w> </span><span class=n>wb_uid</span><span class=p>(</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w></span><span class=n>uid</span><span class=w> </span><span class=n>String</span><span class=p>,</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w></span><span class=n>mobile</span><span class=w> </span><span class=n>String</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w></span><span class=p>)</span><span class=n>ENGINE</span><span class=w> </span><span class=o>=</span><span class=w> </span><span class=n>MergeTree</span><span class=p>()</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>    </span><span class=k>ORDER</span><span class=w> </span><span class=k>BY</span><span class=w>  </span><span class=p>(</span><span class=n>uid</span><span class=p>)</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>    </span><span class=k>PRIMARY</span><span class=w> </span><span class=k>KEY</span><span class=w> </span><span class=p>(</span><span class=n>uid</span><span class=p>);</span><span class=w>
</span></span></span></code></pre></div><p>Table For Query Mobile Phone Number</p><div class=highlight><pre tabindex=0 class=chroma><code class=language-sql data-lang=sql><span class=line><span class=cl><span class=k>CREATE</span><span class=w> </span><span class=k>TABLE</span><span class=w> </span><span class=n>wb_mobile</span><span class=p>(</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w></span><span class=n>uid</span><span class=w> </span><span class=n>String</span><span class=p>,</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w></span><span class=n>mobile</span><span class=w> </span><span class=n>String</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w></span><span class=p>)</span><span class=n>ENGINE</span><span class=w> </span><span class=o>=</span><span class=w> </span><span class=n>MergeTree</span><span class=p>()</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>    </span><span class=k>ORDER</span><span class=w> </span><span class=k>BY</span><span class=w>  </span><span class=p>(</span><span class=n>mobile</span><span class=p>)</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>    </span><span class=k>PRIMARY</span><span class=w> </span><span class=k>KEY</span><span class=w> </span><span class=p>(</span><span class=n>mobile</span><span class=p>);</span><span class=w>
</span></span></span></code></pre></div><h2 id=query-data>Query Data<a hidden class=anchor aria-hidden=true href=#query-data>#</a></h2><p><a href=https://github.com/OwO-Network/WeiboSearcher>WeiboSearcher</a> is an API program written in Golang. But he is not out of the box, because there is no configuration file that allows you to modify the database information, which will be supported in the future. But you can modify some of the configuration code and recompile it yourself.</p><div class=highlight><pre tabindex=0 class=chroma><code class=language-shell data-lang=shell><span class=line><span class=cl>./weibo_linux_amd64
</span></span></code></pre></div><h2 id=qa>Q&amp;A<a hidden class=anchor aria-hidden=true href=#qa>#</a></h2><ul><li>Why not use a MySQL database?</li></ul><blockquote><p>Because even after building indexes, sorting, and splitting tables, MySQL data is much worse than Clickhouse, I gave up on optimizing MySQL query speed.</p></blockquote><ul><li>Why use two tables?</li></ul><blockquote><p>Because two tables are used and the indexes are different fields. It can greatly speed up the query efficiency.</p></blockquote><ul><li>Where is the data downloaded from?</li></ul><blockquote><p>We do not provide any data, and we do not keep any data. Please find your own data sources.</p></blockquote></div><footer class=post-footer><ul class=post-tags><li><a href=https://missuo.me/tags/weibo/>Weibo</a></li><li><a href=https://missuo.me/tags/clickhouse/>Clickhouse</a></li></ul><nav class=paginav><a class=prev href=https://missuo.me/posts/chatgpt-plus/><span class=title>« Prev</span><br><span>I subscribed to ChatGPT Plus</span>
</a><a class=next href=https://missuo.me/posts/fuck-miui/><span class=title>Next »</span><br><span>Remove National Anti-Fraud Center on MIUI</span></a></nav></footer><link rel=stylesheet href=https://cdn.jsdelivr.net/npm/gitalk@1/dist/gitalk.css><script src=https://cdn.jsdelivr.net/npm/gitalk@1/dist/gitalk.min.js></script><div id=gitalk-container></div><script>var gitalk=new Gitalk({clientID:"bb66e2f6184531acc333",clientSecret:"5b56d8f825539fbf01d0b87b5cdba9c6651f1373",repo:"missuo.github.io",owner:"missuo",admin:["missuo"],id:location.pathname,distractionFreeMode:!1});gitalk.render("gitalk-container")</script></article></main><footer class=footer><span>&copy; 2024 <a href=https://missuo.me/>Vincent's Notes</a></span>
<span>Powered by
<a href=https://gohugo.io/ rel="noopener noreferrer" target=_blank>Hugo</a> &
        <a href=https://github.com/adityatelange/hugo-PaperMod/ rel=noopener target=_blank>PaperMod</a></span></footer><a href=#top aria-label="go to top" title="Go to Top (Alt + G)" class=top-link id=top-link accesskey=g><svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 12 6" fill="currentcolor"><path d="M12 6H0l6-6z"/></svg>
</a><script>let menu=document.getElementById("menu");menu&&(menu.scrollLeft=localStorage.getItem("menu-scroll-position"),menu.onscroll=function(){localStorage.setItem("menu-scroll-position",menu.scrollLeft)}),document.querySelectorAll('a[href^="#"]').forEach(e=>{e.addEventListener("click",function(e){e.preventDefault();var t=this.getAttribute("href").substr(1);window.matchMedia("(prefers-reduced-motion: reduce)").matches?document.querySelector(`[id='${decodeURIComponent(t)}']`).scrollIntoView():document.querySelector(`[id='${decodeURIComponent(t)}']`).scrollIntoView({behavior:"smooth"}),t==="top"?history.replaceState(null,null," "):history.pushState(null,null,`#${t}`)})})</script><script>var mybutton=document.getElementById("top-link");window.onscroll=function(){document.body.scrollTop>800||document.documentElement.scrollTop>800?(mybutton.style.visibility="visible",mybutton.style.opacity="1"):(mybutton.style.visibility="hidden",mybutton.style.opacity="0")}</script><script>document.getElementById("theme-toggle").addEventListener("click",()=>{document.body.className.includes("dark")?(document.body.classList.remove("dark"),localStorage.setItem("pref-theme","light")):(document.body.classList.add("dark"),localStorage.setItem("pref-theme","dark"))})</script></body></html>